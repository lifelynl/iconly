import fs from 'fs';
import path from 'path';
import SVGO from 'svgo';
export class IconlyGenerator {
  constructor(config) {
    if (!process.argv[2] || !process.argv[3]) {
      logger('+------------------------------------------------------------------+', true);
      logger('| ERROR: Please supply input- -AND- output- directory as arguments |', true);
      logger('|                                                                  |', true);
      logger('|           --> iconly [inputDir] [outputDir] <--                  |', true);
      logger('+------------------------------------------------------------------+', true);
      process.exit(1);
    }

    this.counter = 0;
    this.config = config;

    if (this.config.createIconComponents) {
      logger('ERROR: Creation of Icon components is not supported yet', true);
      process.exit(1);
    }

    this.svgo = new SVGO({
      plugins: [{
        cleanupAttrs: true
      }, {
        removeDoctype: true
      }, {
        removeXMLProcInst: true
      }, {
        removeComments: true
      }, {
        removeMetadata: true
      }, {
        removeXMLNS: true
      }, {
        removeTitle: true
      }, {
        removeDesc: true
      }, {
        removeUselessDefs: true
      }, {
        removeEditorsNSData: true
      }, {
        removeEmptyAttrs: true
      }, {
        removeHiddenElems: true
      }, {
        removeEmptyText: true
      }, {
        removeEmptyContainers: true
      }, {
        removeViewBox: false
      }, {
        cleanupEnableBackground: true
      }, {
        convertStyleToAttrs: true
      }, {
        convertColors: true
      }, {
        convertPathData: true
      }, {
        convertTransform: true
      }, {
        removeUnknownsAndDefaults: true
      }, {
        removeNonInheritableGroupAttrs: true
      }, {
        removeUselessStrokeAndFill: true
      }, {
        removeUnusedNS: true
      }, {
        cleanupIDs: true
      }, {
        cleanupNumericValues: true
      }, {
        moveElemsAttrsToGroup: true
      }, {
        moveGroupAttrsToElems: true
      }, {
        collapseGroups: true
      }, {
        removeRasterImages: false
      }, {
        mergePaths: true
      }, {
        convertShapeToPath: true
      }, {
        sortAttrs: true
      }, {
        removeDimensions: true
      }, {
        removeAttrs: {
          attrs: '(stroke|fill)'
        }
      }]
    });
    this.run();
  }

  async run() {
    const {
      sourceDir,
      destDir,
      outputFilename,
      beautifyJson
    } = this.config;

    if (!fs.existsSync(destDir)) {
      fs.mkdirSync(destDir);
    }

    fs.writeFileSync(path.join(`${destDir}/${outputFilename ? outputFilename : 'iconlyData'}.json`), JSON.stringify((await this.scanDir(sourceDir)), null, beautifyJson ? 4 : 0));
    logger(`Iconly Generator exported ${this.counter} SVG's into [${this.config.destDir}/${this.config.outputFilename ? this.config.outputFilename : 'iconlyData'}.json]`);
  }

  async scanDir(dir) {
    const iconsData = {};
    const dirContent = fs.readdirSync(path.resolve(dir));

    for (const entry of dirContent) {
      const entryPath = `${dir}/${entry}`;
      const parsingArray = entry.split('_');
      const entryName = this.clean(parsingArray[0].toLowerCase());
      const isDir = fs.lstatSync(entryPath).isDirectory();

      if (isDir) {
        const iconData = await this.scanDir(entryPath);

        if (!iconData) {
          logger(`Couldn't get data for ${entryPath}`);
          return process.exit(1);
        }

        iconsData[`${entryName}Group`] = iconData;
      } else if (path.extname(entry) === '.svg') {
        const svgData = await this.optimizeSVG(fs.readFileSync(entryPath, 'utf8'));

        if (!iconsData[entryName]) {
          iconsData[entryName] = {
            name: entryName,
            svgs: [{
              sourcePath: entryPath,
              size: this.getViewboxSize(svgData),
              fileData: svgData
            }]
          };
          this.counter++;
        } else {
          try {
            const iconData = iconsData[entryName];

            if (!iconData || !iconData.svgs) {
              throw new Error('Unexpected empty data');
            }

            iconData.svgs.push({
              sourcePath: entryPath,
              size: this.getViewboxSize(svgData),
              fileData: svgData
            });
            this.counter++;
          } catch (err) {
            throw new Error(err);
          }
        }
      }
    }

    return iconsData;
  }

  clean(path) {
    return path.replace(this.config.sourceDir, '').replace(new RegExp('/', 'g'), '').replace(new RegExp(' ', 'g'), '-').replace('.svg', '');
  }

  async optimizeSVG(svgData) {
    const optimized = await this.svgo.optimize(svgData);
    return optimized.data;
  }

  getViewboxSize(svgData) {
    const viewboxData = svgData.split('viewBox="')[1].split('"')[0].split(' ');
    const width = viewboxData[2];
    const height = viewboxData[3];
    return [parseInt(width, 10), parseInt(height, 10)];
  }

}

function logger(text, isError) {
  if (isError) {
    // eslint-disable-next-line no-console
    console.error(text);
    return;
  }

  if (process.argv[4] === '-v') {
    // eslint-disable-next-line no-console
    console.log(text);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9nZW5lcmF0b3IudHMiXSwibmFtZXMiOlsiZnMiLCJwYXRoIiwiU1ZHTyIsIkljb25seUdlbmVyYXRvciIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwicHJvY2VzcyIsImFyZ3YiLCJsb2dnZXIiLCJleGl0IiwiY291bnRlciIsImNyZWF0ZUljb25Db21wb25lbnRzIiwic3ZnbyIsInBsdWdpbnMiLCJjbGVhbnVwQXR0cnMiLCJyZW1vdmVEb2N0eXBlIiwicmVtb3ZlWE1MUHJvY0luc3QiLCJyZW1vdmVDb21tZW50cyIsInJlbW92ZU1ldGFkYXRhIiwicmVtb3ZlWE1MTlMiLCJyZW1vdmVUaXRsZSIsInJlbW92ZURlc2MiLCJyZW1vdmVVc2VsZXNzRGVmcyIsInJlbW92ZUVkaXRvcnNOU0RhdGEiLCJyZW1vdmVFbXB0eUF0dHJzIiwicmVtb3ZlSGlkZGVuRWxlbXMiLCJyZW1vdmVFbXB0eVRleHQiLCJyZW1vdmVFbXB0eUNvbnRhaW5lcnMiLCJyZW1vdmVWaWV3Qm94IiwiY2xlYW51cEVuYWJsZUJhY2tncm91bmQiLCJjb252ZXJ0U3R5bGVUb0F0dHJzIiwiY29udmVydENvbG9ycyIsImNvbnZlcnRQYXRoRGF0YSIsImNvbnZlcnRUcmFuc2Zvcm0iLCJyZW1vdmVVbmtub3duc0FuZERlZmF1bHRzIiwicmVtb3ZlTm9uSW5oZXJpdGFibGVHcm91cEF0dHJzIiwicmVtb3ZlVXNlbGVzc1N0cm9rZUFuZEZpbGwiLCJyZW1vdmVVbnVzZWROUyIsImNsZWFudXBJRHMiLCJjbGVhbnVwTnVtZXJpY1ZhbHVlcyIsIm1vdmVFbGVtc0F0dHJzVG9Hcm91cCIsIm1vdmVHcm91cEF0dHJzVG9FbGVtcyIsImNvbGxhcHNlR3JvdXBzIiwicmVtb3ZlUmFzdGVySW1hZ2VzIiwibWVyZ2VQYXRocyIsImNvbnZlcnRTaGFwZVRvUGF0aCIsInNvcnRBdHRycyIsInJlbW92ZURpbWVuc2lvbnMiLCJyZW1vdmVBdHRycyIsImF0dHJzIiwicnVuIiwic291cmNlRGlyIiwiZGVzdERpciIsIm91dHB1dEZpbGVuYW1lIiwiYmVhdXRpZnlKc29uIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsIndyaXRlRmlsZVN5bmMiLCJqb2luIiwiSlNPTiIsInN0cmluZ2lmeSIsInNjYW5EaXIiLCJkaXIiLCJpY29uc0RhdGEiLCJkaXJDb250ZW50IiwicmVhZGRpclN5bmMiLCJyZXNvbHZlIiwiZW50cnkiLCJlbnRyeVBhdGgiLCJwYXJzaW5nQXJyYXkiLCJzcGxpdCIsImVudHJ5TmFtZSIsImNsZWFuIiwidG9Mb3dlckNhc2UiLCJpc0RpciIsImxzdGF0U3luYyIsImlzRGlyZWN0b3J5IiwiaWNvbkRhdGEiLCJleHRuYW1lIiwic3ZnRGF0YSIsIm9wdGltaXplU1ZHIiwicmVhZEZpbGVTeW5jIiwibmFtZSIsInN2Z3MiLCJzb3VyY2VQYXRoIiwic2l6ZSIsImdldFZpZXdib3hTaXplIiwiZmlsZURhdGEiLCJFcnJvciIsInB1c2giLCJlcnIiLCJyZXBsYWNlIiwiUmVnRXhwIiwib3B0aW1pemVkIiwib3B0aW1pemUiLCJkYXRhIiwidmlld2JveERhdGEiLCJ3aWR0aCIsImhlaWdodCIsInBhcnNlSW50IiwidGV4dCIsImlzRXJyb3IiLCJjb25zb2xlIiwiZXJyb3IiLCJsb2ciXSwibWFwcGluZ3MiOiJBQUFBLE9BQU9BLEVBQVAsTUFBZSxJQUFmO0FBQ0EsT0FBT0MsSUFBUCxNQUFpQixNQUFqQjtBQUNBLE9BQU9DLElBQVAsTUFBaUIsTUFBakI7QUFnQ0EsT0FBTyxNQUFNQyxlQUFOLENBQXNCO0FBS2xCQyxFQUFBQSxXQUFQLENBQW1CQyxNQUFuQixFQUEwQztBQUN0QyxRQUFJLENBQUNDLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLENBQWIsQ0FBRCxJQUFvQixDQUFDRCxPQUFPLENBQUNDLElBQVIsQ0FBYSxDQUFiLENBQXpCLEVBQTBDO0FBQ3RDQyxNQUFBQSxNQUFNLENBQUMsc0VBQUQsRUFBeUUsSUFBekUsQ0FBTjtBQUNBQSxNQUFBQSxNQUFNLENBQUMsc0VBQUQsRUFBeUUsSUFB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S2pGLElBQUwsQ0FBVWtGLFFBQVYsQ0FBbUJmLE9BQW5CLENBQXhCO0FBQ0EsV0FBT2MsU0FBUyxDQUFDRSxJQUFqQjtBQUNIOztBQUVPVCxFQUFBQSxjQUFSLENBQXVCUCxPQUF2QixFQUF3QztBQUNwQyxVQUFNaUIsV0FBVyxHQUFHakIsT0FBTyxDQUN0QlQsS0FEZSxDQUNULFdBRFMsRUFDSSxDQURKLEVBRWZBLEtBRmUsQ0FFVCxHQUZTLEVBRUosQ0FGSSxFQUdmQSxLQUhlLENBR1QsR0FIUyxDQUFwQjtBQUlBLFVBQU0yQixLQUFLLEdBQUdELFdBQVcsQ0FBQyxDQUFELENBQXpCO0FBQ0EsVUFBTUUsTUFBTSxHQUFHRixXQUFXLENBQUMsQ0FBRCxDQUExQjtBQUVBLFdBQU8sQ0FBQ0csUUFBUSxDQUFDRixLQUFELEVBQVEsRUFBUixDQUFULEVBQXNCRSxRQUFRLENBQUNELE1BQUQsRUFBUyxFQUFULENBQTlCLENBQVA7QUFDSDs7QUExT3dCOztBQTZPN0IsU0FBUzFGLE1BQVQsQ0FBZ0I0RixJQUFoQixFQUE4QkMsT0FBOUIsRUFBaUQ7QUFDN0MsTUFBSUEsT0FBSixFQUFhO0FBQ1Q7QUFDQUMsSUFBQUEsT0FBTyxDQUFDQyxLQUFSLENBQWNILElBQWQ7QUFDQTtBQUNIOztBQUVELE1BQUk5RixPQUFPLENBQUNDLElBQVIsQ0FBYSxDQUFiLE1BQW9CLElBQXhCLEVBQThCO0FBQzFCO0FBQ0ErRixJQUFBQSxPQUFPLENBQUNFLEdBQVIsQ0FBWUosSUFBWjtBQUNIO0FBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IFNWR08gZnJvbSAnc3ZnbydcblxuaW50ZXJmYWNlIENvbmZpZ3VyYXRpb24ge1xuICAgIHNvdXJjZURpcjogc3RyaW5nXG4gICAgZGVzdERpcjogc3RyaW5nXG4gICAgb3V0cHV0RmlsZW5hbWU/OiBzdHJpbmdcbiAgICBiZWF1dGlmeUpzb24/OiBib29sZWFuXG4gICAgY3JlYXRlSWNvbkNvbXBvbmVudHM/OiBib29sZWFuXG59XG5cbmludGVyZmFjZSBJY29uU2l6ZSB7XG4gICAgd2lkdGg6IG51bWJlclxuICAgIGhlaWdodD86IG51bWJlclxufVxuXG5leHBvcnQgdHlwZSBJY29uU2l6ZVR5cGUgPSBudW1iZXIgfCBudW1iZXJbXSB8IEljb25TaXplXG5cbmV4cG9ydCBpbnRlcmZhY2UgSWNvbkRhdGEge1xuICAgIHNpemU6IG51bWJlcltdIC8vIE5PVEU6IFRoaXMgc2hvdWxkIGJlIFtudW1iZXIsIG51bWJlcl0gYnV0IFRTIGRvZXNuJ3QgdW5kZXJzdGFuZCB0aGlzIHdoZW4gcmUtaW1wb3J0aW5nIHRoZSBnZW5lcmF0ZWQgSlNPTlxuICAgIHNvdXJjZVBhdGg6IHN0cmluZ1xuICAgIGZpbGVEYXRhOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJY29uVHlwZSB7XG4gICAgbmFtZT86IHN0cmluZ1xuICAgIHN2Z3M/OiBJY29uRGF0YVtdXG59XG5cbmludGVyZmFjZSBJY29uc0RhdGEge1xuICAgIFtrZXk6IHN0cmluZ106IEljb25UeXBlXG59XG5cbmV4cG9ydCBjbGFzcyBJY29ubHlHZW5lcmF0b3Ige1xuICAgIHByaXZhdGUgY29uZmlnOiBDb25maWd1cmF0aW9uXG4gICAgcHJpdmF0ZSBzdmdvOiBTVkdPXG4gICAgcHJpdmF0ZSBjb3VudGVyOiBudW1iZXJcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3Rvcihjb25maWc6IENvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgaWYgKCFwcm9jZXNzLmFyZ3ZbMl0gfHwgIXByb2Nlc3MuYXJndlszXSkge1xuICAgICAgICAgICAgbG9nZ2VyKCcrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKycsIHRydWUpXG4gICAgICAgICAgICBsb2dnZXIoJ3wgRVJST1I6IFBsZWFzZSBzdXBwbHkgaW5wdXQtIC1BTkQtIG91dHB1dC0gZGlyZWN0b3J5IGFzIGFyZ3VtZW50cyB8JywgdHJ1ZSlcbiAgICAgICAgICAgIGxvZ2dlcignfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwnLCB0cnVlKVxuICAgICAgICAgICAgbG9nZ2VyKCd8ICAgICAgICAgICAtLT4gaWNvbmx5IFtpbnB1dERpcl0gW291dHB1dERpcl0gPC0tICAgICAgICAgICAgICAgICAgfCcsIHRydWUpXG4gICAgICAgICAgICBsb2dnZXIoJystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rJywgdHJ1ZSlcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jb3VudGVyID0gMFxuICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZ1xuXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5jcmVhdGVJY29uQ29tcG9uZW50cykge1xuICAgICAgICAgICAgbG9nZ2VyKCdFUlJPUjogQ3JlYXRpb24gb2YgSWNvbiBjb21wb25lbnRzIGlzIG5vdCBzdXBwb3J0ZWQgeWV0JywgdHJ1ZSlcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zdmdvID0gbmV3IFNWR08oe1xuICAgICAgICAgICAgcGx1Z2luczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYW51cEF0dHJzOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVEb2N0eXBlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVYTUxQcm9jSW5zdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ29tbWVudHM6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZU1ldGFkYXRhOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVYTUxOUzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlVGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZURlc2M6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVVzZWxlc3NEZWZzOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVFZGl0b3JzTlNEYXRhOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVFbXB0eUF0dHJzOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVIaWRkZW5FbGVtczogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRW1wdHlUZXh0OiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVFbXB0eUNvbnRhaW5lcnM6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVZpZXdCb3g6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjbGVhbnVwRW5hYmxlQmFja2dyb3VuZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29udmVydFN0eWxlVG9BdHRyczogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29udmVydENvbG9yczogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29udmVydFBhdGhEYXRhOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb252ZXJ0VHJhbnNmb3JtOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVVbmtub3duc0FuZERlZmF1bHRzOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVOb25Jbmhlcml0YWJsZUdyb3VwQXR0cnM6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVVzZWxlc3NTdHJva2VBbmRGaWxsOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVVbnVzZWROUzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYW51cElEczogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYW51cE51bWVyaWNWYWx1ZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG1vdmVFbGVtc0F0dHJzVG9Hcm91cDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbW92ZUdyb3VwQXR0cnNUb0VsZW1zOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb2xsYXBzZUdyb3VwczogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlUmFzdGVySW1hZ2VzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbWVyZ2VQYXRoczogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29udmVydFNoYXBlVG9QYXRoOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBzb3J0QXR0cnM6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZURpbWVuc2lvbnM6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUF0dHJzOiB7IGF0dHJzOiAnKHN0cm9rZXxmaWxsKScgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLnJ1bigpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBydW4oKSB7XG4gICAgICAgIGNvbnN0IHsgc291cmNlRGlyLCBkZXN0RGlyLCBvdXRwdXRGaWxlbmFtZSwgYmVhdXRpZnlKc29uIH0gPSB0aGlzLmNvbmZpZ1xuXG4gICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhkZXN0RGlyKSkge1xuICAgICAgICAgICAgZnMubWtkaXJTeW5jKGRlc3REaXIpXG4gICAgICAgIH1cblxuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKFxuICAgICAgICAgICAgcGF0aC5qb2luKGAke2Rlc3REaXJ9LyR7b3V0cHV0RmlsZW5hbWUgPyBvdXRwdXRGaWxlbmFtZSA6ICdpY29ubHlEYXRhJ30uanNvbmApLFxuICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoYXdhaXQgdGhpcy5zY2FuRGlyKHNvdXJjZURpciksIG51bGwsIGJlYXV0aWZ5SnNvbiA/IDQgOiAwKVxuICAgICAgICApXG5cbiAgICAgICAgbG9nZ2VyKFxuICAgICAgICAgICAgYEljb25seSBHZW5lcmF0b3IgZXhwb3J0ZWQgJHt0aGlzLmNvdW50ZXJ9IFNWRydzIGludG8gWyR7dGhpcy5jb25maWcuZGVzdERpcn0vJHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5vdXRwdXRGaWxlbmFtZSA/IHRoaXMuY29uZmlnLm91dHB1dEZpbGVuYW1lIDogJ2ljb25seURhdGEnXG4gICAgICAgICAgICB9Lmpzb25dYFxuICAgICAgICApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBzY2FuRGlyKGRpcjogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGljb25zRGF0YTogSWNvbnNEYXRhID0ge31cbiAgICAgICAgY29uc3QgZGlyQ29udGVudCA9IGZzLnJlYWRkaXJTeW5jKHBhdGgucmVzb2x2ZShkaXIpKVxuXG4gICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZGlyQ29udGVudCkge1xuICAgICAgICAgICAgY29uc3QgZW50cnlQYXRoID0gYCR7ZGlyfS8ke2VudHJ5fWBcbiAgICAgICAgICAgIGNvbnN0IHBhcnNpbmdBcnJheSA9IGVudHJ5LnNwbGl0KCdfJylcbiAgICAgICAgICAgIGNvbnN0IGVudHJ5TmFtZSA9IHRoaXMuY2xlYW4ocGFyc2luZ0FycmF5WzBdLnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICAgICBjb25zdCBpc0RpciA9IGZzLmxzdGF0U3luYyhlbnRyeVBhdGgpLmlzRGlyZWN0b3J5KClcblxuICAgICAgICAgICAgaWYgKGlzRGlyKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWNvbkRhdGEgPSBhd2FpdCB0aGlzLnNjYW5EaXIoZW50cnlQYXRoKVxuXG4gICAgICAgICAgICAgICAgaWYgKCFpY29uRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIoYENvdWxkbid0IGdldCBkYXRhIGZvciAke2VudHJ5UGF0aH1gKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvY2Vzcy5leGl0KDEpXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWNvbnNEYXRhW2Ake2VudHJ5TmFtZX1Hcm91cGBdID0gaWNvbkRhdGFcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aC5leHRuYW1lKGVudHJ5KSA9PT0gJy5zdmcnKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3ZnRGF0YSA9IGF3YWl0IHRoaXMub3B0aW1pemVTVkcoZnMucmVhZEZpbGVTeW5jKGVudHJ5UGF0aCwgJ3V0ZjgnKSlcblxuICAgICAgICAgICAgICAgIGlmICghaWNvbnNEYXRhW2VudHJ5TmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWNvbnNEYXRhW2VudHJ5TmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBlbnRyeU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdmdzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VQYXRoOiBlbnRyeVBhdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IHRoaXMuZ2V0Vmlld2JveFNpemUoc3ZnRGF0YSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVEYXRhOiBzdmdEYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY291bnRlcisrXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGljb25EYXRhID0gaWNvbnNEYXRhW2VudHJ5TmFtZV1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpY29uRGF0YSB8fCAhaWNvbkRhdGEuc3Zncykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCBlbXB0eSBkYXRhJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkRhdGEuc3Zncy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VQYXRoOiBlbnRyeVBhdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogdGhpcy5nZXRWaWV3Ym94U2l6ZShzdmdEYXRhKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlRGF0YTogc3ZnRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvdW50ZXIrK1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnIpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGljb25zRGF0YVxuICAgIH1cblxuICAgIHByaXZhdGUgY2xlYW4ocGF0aDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBwYXRoXG4gICAgICAgICAgICAucmVwbGFjZSh0aGlzLmNvbmZpZy5zb3VyY2VEaXIsICcnKVxuICAgICAgICAgICAgLnJlcGxhY2UobmV3IFJlZ0V4cCgnLycsICdnJyksICcnKVxuICAgICAgICAgICAgLnJlcGxhY2UobmV3IFJlZ0V4cCgnICcsICdnJyksICctJylcbiAgICAgICAgICAgIC5yZXBsYWNlKCcuc3ZnJywgJycpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBvcHRpbWl6ZVNWRyhzdmdEYXRhOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgb3B0aW1pemVkID0gYXdhaXQgdGhpcy5zdmdvLm9wdGltaXplKHN2Z0RhdGEpXG4gICAgICAgIHJldHVybiBvcHRpbWl6ZWQuZGF0YVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Vmlld2JveFNpemUoc3ZnRGF0YTogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHZpZXdib3hEYXRhID0gc3ZnRGF0YVxuICAgICAgICAgICAgLnNwbGl0KCd2aWV3Qm94PVwiJylbMV1cbiAgICAgICAgICAgIC5zcGxpdCgnXCInKVswXVxuICAgICAgICAgICAgLnNwbGl0KCcgJylcbiAgICAgICAgY29uc3Qgd2lkdGggPSB2aWV3Ym94RGF0YVsyXVxuICAgICAgICBjb25zdCBoZWlnaHQgPSB2aWV3Ym94RGF0YVszXVxuXG4gICAgICAgIHJldHVybiBbcGFyc2VJbnQod2lkdGgsIDEwKSwgcGFyc2VJbnQoaGVpZ2h0LCAxMCldXG4gICAgfVxufVxuXG5mdW5jdGlvbiBsb2dnZXIodGV4dDogc3RyaW5nLCBpc0Vycm9yPzogYm9vbGVhbikge1xuICAgIGlmIChpc0Vycm9yKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgIGNvbnNvbGUuZXJyb3IodGV4dClcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgaWYgKHByb2Nlc3MuYXJndls0XSA9PT0gJy12Jykge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICBjb25zb2xlLmxvZyh0ZXh0KVxuICAgIH1cbn1cbiJdfQ==